<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toy City ‚Äì Order Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
  :root{--pri:#4f46e5;--ink:#0f172a;--sub:#64748b;--line:#e5e7eb;--bg:#f6f7fb;}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); color:var(--ink)}
  .wrap{max-width:1000px;margin:28px auto;padding:0 16px}
  .top{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:16px}
  .pill{background:#fff;border:1px solid var(--line);padding:10px 14px;border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,.04)}
  .btn{background:var(--pri);color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn.out{background:#fff;color:var(--ink);border:1px solid var(--line)}
  h1{font-size:22px;margin:0}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px; padding:14px}
  .muted{color:var(--sub)}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid var(--line);font-size:14px}
  th{background:#eef2ff;color:#3730a3;text-align:left}
  .right{text-align:right}
  .status{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:600}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .grow{flex:1}
  input,select{border:1px solid var(--line);border-radius:10px;padding:10px 12px;width:100%}
  .space{height:10px}
  /* Timeline */
  .tc-timeline{margin:12px 0 16px;padding:14px;border:1px solid var(--line);border-radius:12px;background:#fff}
  .tc-steps{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;position:relative}
  .tc-steps:before{content:"";position:absolute;left:8%;right:8%;top:22px;height:4px;background:var(--line);border-radius:2px}
  .tc-fill{position:absolute;left:8%;top:22px;height:4px;background:#3b82f6;border-radius:2px;width:0}
  .tc-step{text-align:center}
  .tc-iconwrap{width:44px;height:44px;margin:0 auto 8px;border-radius:999px;display:grid;place-items:center;border:2px solid #cbd5e1;color:#64748b;background:#f8fafc}
  .tc-step.done .tc-iconwrap{background:#22c55e;border-color:#22c55e;color:#fff}
  .tc-step.active .tc-iconwrap{background:#3b82f6;border-color:#3b82f6;color:#fff}
  .tc-label{font-size:13px;font-weight:600}
  .tc-time{font-size:12px;color:var(--sub)}
  @media (max-width:720px){
    .tc-steps{display:block}
    .tc-steps:before,.tc-fill{display:none}
    .tc-step{display:flex;align-items:flex-start;gap:12px;text-align:left}
    .tc-step+.tc-step{margin-top:10px;padding-top:10px;border-top:1px dashed var(--line)}
    .tc-iconwrap{margin:0}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <h1>üéÆ Toy City ‚Äì Order Portal</h1>
    <div class="row">
      <button class="btn out" onclick="showCustomer()">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
      <button class="btn out" onclick="showAdmin()">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin</button>
    </div>
  </div>

  <!-- Customer Panel -->
  <div id="panel-cus" class="card" style="display:block">
    <h3 style="margin:6px 0 12px">üîé ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á</h3>
    <div id="cus-info" class="muted" style="margin-bottom:8px">
      ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    </div>
    <div id="cus-result"></div>
  </div>

  <div class="space"></div>

  <!-- Admin Panel -->
  <div id="panel-admin" class="card" style="display:none">
    <h3 style="margin:6px 0 12px">‚öôÔ∏è Admin Console</h3>
    <div id="adm-login" class="row">
      <div class="grow"><input id="adm-pass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin"></div>
      <button class="btn" onclick="loginAdmin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    <div id="adm-area" style="display:none">
      <div class="row">
        <select id="filter-shop" class="grow">
          <option value="">From Shop</option>
          <option>TE1</option><option>TE3</option><option>LS6</option>
        </select>
        <input id="filter-booking" class="grow" placeholder="‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏à‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 102380)">
        <button class="btn out" onclick="loadAdmin()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
      </div>
      <div id="adm-list" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<script>
/*** ====== CONFIG ====== ***/
// ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Web App (GAS) ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß
const API_BASE = 'https://script.google.com/macros/library/d/131YWF669fedQUp2oF4pcxgqXKsI6KHmL1bo_2SvtYEudeIwRB7kO_cFF/18'; // ‡πÄ‡∏ä‡πà‡∏ô https://script.google.com/macros/s/XXXX/exec
const ADMIN_PASS = '6515';

/*** ====== Utils ====== ***/
const $ = (s,sc=document)=>sc.querySelector(s);
const $$= (s,sc=document)=>Array.from(sc.querySelectorAll(s));
function q(k){return new URLSearchParams(location.search).get(k)||'';}
function money(n){return Number(n||0).toLocaleString('th-TH');}
function discLabel(s){
  s = String(s??'').trim();
  if(!s) return '‡πÑ‡∏°‡πà‡∏°‡∏µ';
  const m = s.match(/(\d+(?:\.\d+)?)\s*%/);
  if(m) return `${(+m[1]).toString().replace(/\.0+$/,'')}%`;
  const n = parseFloat(s); if(isNaN(n)) return s;
  const pct = n>1 ? n : n*100; return `${(+pct).toString().replace(/\.0+$/,'')}%`;
}
async function api(action, params={}){
  const qs = new URLSearchParams({action, ...params}).toString();
  const res = await fetch(`${API_BASE}?${qs}`, {cache:'no-store'});
  return res.json();
}
function statusBadge(s){ return `<span class="status">${s||'-'}</span>`; }

/*** ====== Timeline icons & steps ====== ***/
const TC_ICONS = {
  book:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M6 4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12v-2H6V6h10a2 2 0 0 1 2 2v10h2V8a4 4 0 0 0-4-4H6z"/></svg>',
  gear:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19.4 13a7.58 7.58 0 0 0 .06-2l2.12-1.65-2-3.46-2.49.5a7.3 7.3 0 0 0-1.72-1L12.9 2h-3.8L8 4.39a7.3 7.3 0 0 0-1.72 1l-2.49-.5-2 3.46L3.9 11a7.58 7.58 0 0 0 .06 2l-2.12 1.65 2 3.46 2.49-.5a7.3 7.3 0 0 0 1.72 1L9.1 22h3.8L16 19.61a7.3 7.3 0 0 0 1.72-1l2.49.5 2-3.46Zm-7.4 2.5A3.5 3.5 0 1 1 15.5 12a3.5 3.5 0 0 1-3.5 3.5Z"/></svg>',
  truck:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 7h11v7H3z"/><path d="M14 8h4l3 3v3h-7V8z"/><circle cx="6.5" cy="17.5" r="1.5"/><circle cx="16.5" cy="17.5" r="1.5"/></svg>',
  store:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 9 4 4h16l1 5H3z"/><path d="M5 10h14v9H5z"/></svg>',
  check:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>'
};
const TC_STEPS = [
  { key: '‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',                    label: '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á', icon:'book'},
  { key: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',         label: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°', icon:'gear'},
  { key: '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢7‡∏ß‡∏±‡∏ô)',   label: '‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á', icon:'truck'},
  { key: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß',             label: '‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô',   icon:'store'},
  { key: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',      label: '‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', icon:'check'}
];
function normStatus(s){return String(s||'').toLowerCase().replace(/\s+/g,'').replace(/[()]/g,'');}
function buildStepTimeline(order){
  const hist = Array.isArray(order.history)? order.history: [];
  const stepMap = {};
  hist.forEach(h=>{ const k = normStatus(h.status); if(!stepMap[k]) stepMap[k]=h.atText||h.atISO||''; });

  // ‡∏´‡∏≤ index ‡∏™‡πÄ‡∏ï‡πá‡∏õ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  let active = -1;
  for(let i=TC_STEPS.length-1;i>=0;i--){
    const nk = normStatus(TC_STEPS[i].key);
    if (stepMap[nk] || (nk===normStatus('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢7‡∏ß‡∏±‡∏ô)') && stepMap[normStatus('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 7 ‡∏ß‡∏±‡∏ô)')])){ active = i; break; }
  }
  if (active<0){
    const k = normStatus(order.status);
    active = Math.max(0, TC_STEPS.findIndex(x=>normStatus(x.key)===k));
  }

  return TC_STEPS.map((s,i)=>{
    const nk = normStatus(s.key);
    const t  = stepMap[nk] || (nk===normStatus('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢7‡∏ß‡∏±‡∏ô)') ? stepMap[normStatus('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 7 ‡∏ß‡∏±‡∏ô)')] : '');
    return {label:s.label, icon:s.icon, time:t||'', state:(i<active)?'done':(i===active?'active':'todo')};
  });
}
function renderTimeline(order, host){
  const steps = buildStepTimeline(order);
  const html = steps.map(s=>`
    <div class="tc-step ${s.state}">
      <div class="tc-iconwrap">${TC_ICONS[s.icon]||''}</div>
      <div class="tc-label">${s.label}</div>
      <div class="tc-time">${s.time||''}</div>
    </div>
  `).join('');
  const done = steps.findIndex(x=>x.state==='todo'); // first todo index
  const idx  = (done===-1)? steps.length-1 : Math.max(0, done-1);
  const fill = (idx<=0)?0 : (idx>=steps.length-1?100:(idx/(steps.length-1))*100);
  host.innerHTML = `<div class="tc-steps"><div class="tc-fill" style="width:${fill}%"></div>${html}</div>`;
}

/*** ====== Customer ====== ***/
async function loadCustomer(){
  const booking = q('booking');
  const token   = q('token');
  const resBox  = $('#cus-result');
  if (!booking || !token){
    resBox.innerHTML = '';
    return;
  }
  resBox.innerHTML = `<div class="pill">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á #${booking} ...</div>`;
  const r = await api('order', {booking, token});
  if (!r.ok || !r.data){ resBox.innerHTML = `<div class="pill">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á #${booking}</div>`; return; }

  const o = r.data;
  const header = `
    <div class="row" style="justify-content:space-between">
      <div><b>Booking #${o.booking}</b> &nbsp; ${statusBadge(o.status)}</div>
      <div class="muted">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô: ${o.fromShop||'-'} ‚Üí ${o.toShop||'-'}</div>
    </div>
    <div class="muted">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${o.statusAt||'-'}</div>
  `;

  const timeline = `<div class="tc-timeline" id="tl"></div>`;

  const th = ['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤','‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î','‡∏£‡∏≤‡∏Ñ‡∏≤','‡∏à‡∏≥‡∏ô‡∏ß‡∏ô','‡∏£‡∏ß‡∏°(‡∏´‡∏•‡∏±‡∏á‡∏•‡∏î)','PROMOTION %','PROMO CODE','CONDITION'];
  const rows = (o.items||[]).map(it=>`
    <tr>
      <td>${it.code||''}</td>
      <td>${it.desc||''}</td>
      <td class="right">${money(it.price)}</td>
      <td class="right">${money(it.qty)}</td>
      <td class="right">${
        (it.amountGross>it.amountNet)
          ? `<span style="text-decoration:line-through;color:#888">${money(it.amountGross)}</span> ‚Üí <b>${money(it.amountNet)}</b>`
          : `<b>${money(it.amountNet||it.amount)}</b>`
      }</td>
      <td>${discLabel(it.disc)}</td>
      <td>${it.discCode||'‡πÑ‡∏°‡πà‡∏°‡∏µ'}</td>
      <td>${it.discRule||'‡πÑ‡∏°‡πà‡∏°‡∏µ'}</td>
    </tr>
  `).join('');
  const table = `
    <table>
      <thead><tr>${th.map(x=>`<th>${x}</th>`).join('')}</tr></thead>
      <tbody>${rows}</tbody>
      <tfoot><tr><td colspan="7" class="right" style="font-weight:700">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td><td class="right" style="font-weight:700">${money(o.total)}</td></tr></tfoot>
    </table>
  `;

  resBox.innerHTML = header + timeline + table;
  renderTimeline(o, $('#tl'));
}

/*** ====== Admin ====== ***/
let ADM_OK = false;
function showCustomer(){ $('#panel-cus').style.display='block'; $('#panel-admin').style.display='none'; }
function showAdmin(){ $('#panel-cus').style.display='none'; $('#panel-admin').style.display='block'; }
function loginAdmin(){
  const pw = $('#adm-pass').value.trim();
  if (pw !== ADMIN_PASS){ alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
  ADM_OK = true;
  $('#adm-login').style.display='none';
  $('#adm-area').style.display='block';
  loadAdmin();
}
async function loadAdmin(){
  if (!ADM_OK) return;
  const res = await api('list', {adminKey:ADMIN_PASS});
  const list = $('#adm-list');
  if (!res.ok){ list.innerHTML = `<div class="pill">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`; return; }
  const data = (res.data||[]);
  const wantBooking = $('#filter-booking').value.trim();
  const wantShop    = $('#filter-shop').value.trim();
  const filtered = data.filter(o=>{
    const okB = wantBooking ? String(o.booking)===wantBooking : true;
    const okS = wantShop ? (String(o.fromShop||'').includes(wantShop)) : true;
    return okB && okS;
  });

  list.innerHTML = filtered.map(o=>{
    const items = (o.items||[]).map(it=>`
      <tr>
        <td>${it.code||''}</td><td>${it.desc||''}</td>
        <td class="right">${money(it.price)}</td>
        <td class="right">${money(it.qty)}</td>
        <td class="right">${money(it.amountNet||it.amount)}</td>
        <td>${discLabel(it.disc)}</td><td>${it.discCode||'‡πÑ‡∏°‡πà‡∏°‡∏µ'}</td><td>${it.discRule||'‡πÑ‡∏°‡πà‡∏°‡∏µ'}</td>
      </tr>`).join('');
    return `
      <div class="card" style="margin-bottom:12px">
        <div class="row" style="justify-content:space-between">
          <div><b>Booking #${o.booking}</b> &nbsp; ${statusBadge(o.status)}</div>
          <div class="muted">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô: ${o.fromShop||'-'} ‚Üí ${o.toShop||'-'}</div>
        </div>
        <div class="muted">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${o.statusAt||'-'}</div>
        <div id="tl-${o.booking}" class="tc-timeline"></div>

        <table style="margin-top:6px">
          <thead><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th class="right">‡∏£‡∏≤‡∏Ñ‡∏≤</th><th class="right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th class="right">‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th><th>%</th><th>CODE</th><th>COND.</th></tr></thead>
          <tbody>${items}</tbody>
          <tfoot><tr><td colspan="7" class="right" style="font-weight:700">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td><td class="right" style="font-weight:700">${money(o.total)}</td></tr></tfoot>
        </table>

        <div class="row" style="margin-top:10px">
          <select id="st-${o.booking}" class="grow">
            <option ${o.status==='‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'?'selected':''}>‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
            <option ${o.status==='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'?'selected':''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
            <option ${o.status.startsWith('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤')?'selected':''}>‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 7 ‡∏ß‡∏±‡∏ô)</option>
            <option ${o.status==='‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß'?'selected':''}>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
            <option ${o.status==='‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'?'selected':''}>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</option>
          </select>
          <button class="btn" onclick="upd('${o.booking}')">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
        </div>
      </div>
    `;
  }).join('');

  // ‡∏ß‡∏≤‡∏î timeline ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏¥‡∏•
  for (const o of filtered){
    renderTimeline(o, document.getElementById('tl-'+o.booking));
  }
}
async function upd(bk){
  const st = $('#st-'+bk).value;
  const r  = await api('update', {adminKey:ADMIN_PASS, booking:bk, status:st});
  if (r.ok){ alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); loadAdmin(); }
  else alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
}

/*** ====== boot ====== ***/
showCustomer();
loadCustomer();
</script>
</body>
</html>
